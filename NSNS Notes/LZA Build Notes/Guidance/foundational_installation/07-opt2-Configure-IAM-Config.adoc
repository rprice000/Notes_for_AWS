=== Step 8: Configure iam-config.yaml

[start=1]
. Open the *iam-config.yaml* file
. Update the *policySets* configuration with the following:

[source,yaml]
----
policySets:
  - deploymentTargets:
      organizationalUnits:
        - Root
    policies:
      - name: Default-Boundary-Policy
        policy: iam-policies/boundary-policy.json
----

[start=3]
. Update the *roleSets* with the following:

[source,yaml]
----
roleSets:
  - deploymentTargets:
      organizationalUnits:
        - Root
    roles:
      - name: EC2-Default-SSM-Instance-Role
        instanceProfile: true
        assumedBy:
          - type: service
            principal: ec2.amazonaws.com
        policies:
          awsManaged:
            - AmazonSSMManagedInstanceCore
            - AmazonSSMDirectoryServiceAccess
            - CloudWatchAgentServerPolicy
      - name: Backup-Role
        assumedBy:
          - type: service
            principal: backup.amazonaws.com
        policies:
          awsManaged:
            - service-role/AWSBackupServiceRolePolicyForBackup
            - service-role/AWSBackupServiceRolePolicyForRestores
----

[start=4]
. Update the *groupSets* configuration with the following:

[source,yaml]
----
groupSets:
  - deploymentTargets:
      organizationalUnits:
        - Root
    groups:
      - name: Administrators
        policies:
          awsManaged:
            - AdministratorAccess
----

[start=5]
. Create the file *iam-policies/boundary-policy.json* and paste the following contents:
[source,json]
----
{
  "Version": "2012-10-17",
  "Statement": [
      {
          "Sid": "AllowListActions",
          "Effect": "Allow",
          "Action": [
              "iam:ListUsers",
              "iam:ListVirtualMFADevices"
          ],
          "Resource": "*"
      },
      {
          "Sid": "AllowUserToCreateVirtualMFADevice",
          "Effect": "Allow",
          "Action": [
              "iam:CreateVirtualMFADevice"
          ],
          "Resource": "arn:*:iam::*:mfa/*"
      },
      {
          "Sid": "AllowUserToManageTheirOwnMFA",
          "Effect": "Allow",
          "Action": [
              "iam:EnableMFADevice",
              "iam:GetMFADevice",
              "iam:ListMFADevices",
              "iam:ResyncMFADevice"
          ],
          "Resource": "arn:*:iam::*:user/${aws:username}"
      },
      {
          "Sid": "AllowUserToDeactivateTheirOwnMFAOnlyWhenUsingMFA",
          "Effect": "Allow",
          "Action": [
              "iam:DeactivateMFADevice"
          ],
          "Resource": [
              "arn:*:iam::*:user/${aws:username}"
          ],
          "Condition": {
              "Bool": {
                  "aws:MultiFactorAuthPresent": "true"
              }
          }
      },
      {
          "Sid": "BlockMostAccessUnlessSignedInWithMFA",
          "Effect": "Deny",
          "NotAction": [
              "iam:CreateVirtualMFADevice",
              "iam:EnableMFADevice",
              "iam:ListMFADevices",
              "iam:ListUsers",
              "iam:ListVirtualMFADevices",
              "iam:ResyncMFADevice"
          ],
          "Resource": "*",
          "Condition": {
              "BoolIfExists": {
                  "aws:MultiFactorAuthPresent": "false"
              }
          }
      }
  ]
}
----

This completes the configuration of *iam-config.yaml*.